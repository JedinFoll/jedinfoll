<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jedi√± Foll ‚Äî Jeu √©ducatif, dr√¥le et strat√©gique</title>
  <link rel="alternate" hreflang="en" href="/jedinfoll/index-en.html">
  <style>
    :root{--mint:#2ec4b6;--bg:#1a1a1a}
    *{box-sizing:border-box}
    body{margin:0;font-family:Arial,sans-serif;background-color:var(--mint);color:#fff}
    header,footer{text-align:center;padding:1rem;background:var(--bg)}
    main{max-width:900px;margin:auto;padding:1rem}
    .topbar{display:flex;justify-content:space-between;align-items:center;max-width:900px;margin:0 auto}
    .lang{font-weight:bold}.lang a{color:#ffcb77;text-decoration:none;margin-left:.5rem}
    .card{background:var(--bg);border-radius:20px;padding:1.5rem;box-shadow:0 4px 12px rgba(0,0,0,.5);margin:1rem auto 2rem}
    h1,h2{color:#fff;margin:0 0 .5rem} h2{color:var(--mint)}
    .price{font-size:1.8rem;font-weight:bold;margin:1rem 0}
    .btn{display:inline-block;padding:.8rem 1.2rem;border-radius:10px;background:linear-gradient(90deg,#00b4d8,#ffcb77);color:#000;font-weight:bold;text-decoration:none}
    .qr{text-align:center;margin-top:1rem}
    .social-links a{color:var(--mint);text-decoration:none;margin:0 10px;font-weight:bold}
    .mentions{font-size:.95rem;color:#ddd;margin-top:1rem;text-align:left;line-height:1.55}
    .flags-inline{display:inline-flex;align-items:center;gap:6px}
    .flag{height:16px;border-radius:2px;border:1px solid #333}
    .small{color:#bbb;font-size:.9rem}
    ul{padding-left:1.2rem}
    .pdf-frame{width:100%;aspect-ratio:1/1.414;max-height:80vh;border:0;background:#fff}
    @media (max-width:600px){.pdf-frame{aspect-ratio:auto;height:70vh}}
    @media print{body{background:#fff;color:#000} header,footer,.card:not(#rules){display:none!important} #rules{box-shadow:none;border:none;background:#fff;color:#000} #rules h2{color:#000}}
    /* √âtoiles + Avis */
    .stars{font-size:1.8rem;user-select:none;display:flex;gap:.1rem}
    .rating-line{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}
    .rating-summary{font-weight:bold}
    .star-btn{font:inherit;background:transparent;border:none;padding:.1rem .2rem;cursor:pointer;line-height:1;color:#aaa;transition:transform .05s ease}
    .star-btn:focus{outline:2px dotted #ffcb77;outline-offset:2px}
    .star-btn.filled{color:#ffcb77}
    .star-btn:hover{transform:scale(1.05)}
    .reviews-list{display:flex;flex-direction:column;gap:1rem;margin-top:1rem}
    .review{background:#111;border:1px solid #2a2a2a;border-radius:12px;padding:1rem}
    .review-header{display:flex;align-items:center;gap:.6rem;margin-bottom:.4rem;font-size:.95rem;color:#ddd}
    .review-author{font-weight:bold;color:#fff}
    .review-date{color:#bbb;font-size:.9rem}
    .review-stars{color:#ffcb77;letter-spacing:.05em}
    .review-body{white-space:pre-wrap;line-height:1.45}
    .reviews-actions{margin-top:1rem;display:flex;gap:.6rem;flex-wrap:wrap}
    .reviews-actions .btn{background:linear-gradient(90deg,#2ec4b6,#ffcb77)}
    .review-empty{color:#bbb;font-style:italic}
    textarea#reviewText{width:100%;min-height:110px;border-radius:12px;border:1px solid #2a2a2a;padding:.8rem;background:#0f0f0f;color:#fff;resize:vertical}
    .review-send{margin-top:.6rem}
    /* Compteur */
    .counter-wrap{display:flex;justify-content:center;gap:.5rem;align-items:center;flex-wrap:wrap}
    .counter-hide{display:none}
    /* Bandeau moyenne visible */
    .avg-banner{display:flex;gap:.5rem;align-items:center;margin:.25rem 0 .75rem;flex-wrap:wrap}
    .avg-stars{font-size:1.6rem}
    .avg-badges{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}
    .badge{background:#0f0f0f;border:1px solid #2a2a2a;color:#fff;border-radius:999px;padding:.2rem .6rem;font-size:.85rem}
    /* Panneau "tous les avis" */
    #allReviewsPanel{margin-top:1rem;border-top:1px dashed #2a2a2a;padding-top:1rem}
    #allReviewsList{display:flex;flex-direction:column;gap:1rem}
    #loadMoreBtn{display:none}
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <div></div>
      <div class="lang">FR / <a href="/jedinfoll/index-en.html">EN</a></div>
    </div>
    <h1>Jedi√± Foll</h1>
    <p>Le jeu de cartes √©ducatif, dr√¥le et strat√©gique</p>
  </header>

  <main>
    <div class="card">
      <h2>Jedi√± Foll</h2>
      <ul>
        <li>1 √† 4 joueurs ¬∑ 10 √† 30 minutes</li>
        <li>√Ä partir de 6 ans</li>
        <li>5 modes de jeu ‚Äî atteindre exactement le r√©sultat demand√© selon le mode choisi</li>
        <li>La bo√Æte contient 102 cartes</li>
      </ul>
    </div>

    <div class="card" id="rules">
      <h2>R√®gles du jeu</h2>
      <p class="small">Lecture directe ci-dessous ‚Ä¢ <a class="btn" href="/jedinfoll/regles.pdf" download>T√©l√©charger le PDF</a></p>
      <object data="/jedinfoll/regles.pdf" type="application/pdf" class="pdf-frame">
        <iframe src="/jedinfoll/regles.pdf" class="pdf-frame" title="R√®gles"></iframe>
      </object>
      <p class="small">Si le PDF ne s‚Äôaffiche pas, <a href="/jedinfoll/regles.pdf" download>cliquez ici pour le t√©l√©charger</a>.</p>
      <button class="btn" onclick="window.print()">üìÑ Imprimer la section R√®gles</button>
    </div>

    <!-- VID√âO -->
    <div class="card" id="videos">
      <h2>Vid√©os</h2>
      <div style="aspect-ratio:16/9; max-width:100%;">
        <iframe width="100%" height="100%" src="https://www.youtube.com/embed/ID_DE_TA_VIDEO" title="Jedi√± Foll ‚Äî D√©mo" frameborder="0" allowfullscreen></iframe>
      </div>
    </div>

    <!-- PR√âCOMMANDE -->
    <div class="card" id="pricing">
      <h2>Pr√©commande</h2>
      <div class="price">14,99 ‚Ç¨</div>

      <!-- Pr√©commande France (+ livraison) -->
      <a href="https://www.paypal.com/ncp/payment/3MJTT9P62VJKY" class="btn">
        üá´üá∑ Pr√©commande France ‚Äî 14,99 ‚Ç¨ + 5 ‚Ç¨ livraison
      </a>

      <!-- Pr√©commande Martinique (retrait sur place) -->
      <a href="https://www.paypal.com/ncp/payment/B3JBUBJQBNQWJ" class="btn" style="margin-left:10px; background:linear-gradient(90deg,#06d6a0,#ffd166);">
        üá≤üá∂ Pr√©commande Martinique ‚Äî 14,99 ‚Ç¨ (Retrait sur place)
      </a>

      <p class="small" style="margin-top:.8rem;">
        ‚è≥ Disponible √† partir de <strong>mi-juin 2026</strong> (ou plus t√¥t selon la production).<br>
        üì¶ France : ajouter 5 ‚Ç¨ pour la livraison.<br>
        üìç Martinique : retrait sur place uniquement (pas d‚Äôexp√©dition).
      </p>
    </div>

    <!-- QR CODE -->
    <div class="card">
      <h2>QR Code</h2>
      <div class="qr">
        <a href="https://api.qrserver.com/v1/create-qr-code/?size=2000x2000&data=https://jedinfoll.github.io/jedinfoll/" download>
          <img src="https://api.qrserver.com/v1/create-qr-code/?size=500x500&data=https://jedinfoll.github.io/jedinfoll/" alt="QR Code vers Jedi√± Foll" style="max-width:300px;">
        </a>
      </div>
      <p class="small">Cliquez sur le QR pour t√©l√©charger en HD.</p>
    </div>

    <!-- AVIS & NOTE -->
    <div class="card" id="reviews">
      <h2>Avis & Note</h2>

      <!-- Bandeau moyenne -->
      <div class="avg-banner" aria-live="polite">
        <div id="avgStars" class="stars avg-stars" aria-label="Note moyenne">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</div>
        <div class="avg-badges">
          <span class="badge">Moyenne : <strong><span id="avgValue">‚Äî</span>/5</strong></span>
          <span class="badge">Votes : <strong><span id="totalVotes">0</span></strong></span>
          <span class="badge">Avis : <strong><span id="totalReviews">0</span></strong></span>
        </div>
      </div>

      <!-- √âtoiles locales (visuel) -->
      <div class="small">Votre note :</div>
      <div class="stars" id="rateStars" aria-label="Noter">
        <button type="button" class="star-btn" data-v="1" aria-label="1 √©toile">‚òÜ</button>
        <button type="button" class="star-btn" data-v="2" aria-label="2 √©toiles">‚òÜ</button>
        <button type="button" class="star-btn" data-v="3" aria-label="3 √©toiles">‚òÜ</button>
        <button type="button" class="star-btn" data-v="4" aria-label="4 √©toiles">‚òÜ</button>
        <button type="button" class="star-btn" data-v="5" aria-label="5 √©toiles">‚òÜ</button>
      </div>

      <!-- Formulaire int√©gr√© (Google Form) -->
      <div class="review-form" style="margin-top:1rem;">
        <p class="small">Laissez votre note (1‚Äì5) et votre avis ci-dessous, puis cliquez sur <em>Envoyer</em>. L‚Äôenregistrement est imm√©diat.</p>
        <div style="width:100%; max-height:700px; overflow:auto; border:1px solid #2a2a2a; border-radius:12px;">
          <!-- ‚õ≥Ô∏è Remplace l‚ÄôURL ci-dessous par ton lien d‚Äôint√©gration Google Form -->
          <iframe id="reviewForm" src="GOOGLE_FORM_EMBED_URL" width="100%" height="700" frameborder="0" marginheight="0" marginwidth="0" style="background:#0f0f0f;">Chargement‚Ä¶</iframe>
        </div>
        <button id="refreshBtn" class="btn" type="button" style="margin-top:.8rem;">üîÑ Actualiser la moyenne et les avis</button>
      </div>

      <!-- Derniers avis -->
      <div class="reviews-list" id="latestReviews">
        <div class="review-empty">Chargement des derniers avis‚Ä¶</div>
      </div>

      <!-- Tous les avis -->
      <div class="reviews-actions">
        <button id="showAllReviewsBtn" class="btn" type="button">üìñ Lire tous les avis</button>
      </div>

      <div id="allReviewsPanel" hidden>
        <div id="allReviewsStatus" class="small">Chargement‚Ä¶</div>
        <div id="allReviewsList"></div>
        <button id="loadMoreBtn" class="btn" type="button">Charger plus</button>
      </div>
    </div>

    <div class="card mentions">
      <h2>Mentions l√©gales</h2>
      <p><strong>√âditeur :</strong> Jedi√± Foll ‚Äî Email : <a href="mailto:jedinfoll@gmail.com">jedinfoll@gmail.com</a></p>
      <p><strong>Responsable de publication :</strong> Jessica Lechertier</p>
      <p><strong>Fabrication :</strong> Cr√©√© en
        <span class="flags-inline">Martinique
          <img src="https://raw.githubusercontent.com/jedinfoll/jedinfoll/main/1000079688.jpg" alt="" class="flag">
        </span>.
      </p>
      <p><strong>H√©bergement :</strong> GitHub Pages ‚Äî GitHub Inc., 88 Colin P Kelly Jr St, San Francisco, CA 94107, USA.</p>
      <p><strong>Propri√©t√© intellectuelle :</strong> Contenus ¬© Jedi√± Foll. Reproduction interdite sans autorisation.</p>
      <p><strong>Donn√©es personnelles :</strong> Les donn√©es collect√©es (commandes, emails) servent uniquement au traitement des achats et ne sont jamais revendues.</p>
    </div>
  </main>

  <footer>
    <div class="social-links">
      <a href="https://www.instagram.com/jedinfoll" target="_blank">Instagram: @jedinfoll</a> |
      <a href="https://www.facebook.com/Jedi%C3%B1%20Foll" target="_blank">Facebook: Jedi√± Foll</a> |
      <a href="mailto:jedinfoll@gmail.com">Email: jedinfoll@gmail.com</a>
    </div>

    <!-- Compteur simple -->
    <div id="counterRow" class="counter-wrap" aria-live="polite">
      <span>üëÅÔ∏è Visites :</span>
      <img id="hitBadge" alt="Compteur de visites"
        src="https://api.visitorbadge.io/api/visitors?path=jedinfoll%2Fgithub-pages-site&label=Visites&countColor=%232EC4B6&style=flat&labelStyle=upper"
        referrerpolicy="no-referrer"
        style="vertical-align:middle;border-radius:6px;max-height:24px"
      />
    </div>

    <p>¬© 2025 Jedi√± Foll ‚Äî Tous droits r√©serv√©s.</p>
  </footer>

  <script>
    (function(){
      /* ===== CONFIG : URL CSV publi√©e ===== */
      const CSV_URL = 'GOOGLE_SHEET_PUBLISHED_CSV_URL'; // ‚õ≥Ô∏è remplace par l‚ÄôURL CSV publi√©e de la feuille de r√©ponses
      const PER_PAGE = 20;

      const $ = id => document.getElementById(id);
      const escapeHTML = s => s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');

      /* √âtoiles visuelles */
      const rateStars = $('rateStars');
      if(rateStars){
        const btns = Array.from(rateStars.querySelectorAll('.star-btn'));
        const paint = n => btns.forEach((b,i)=>{ b.textContent=(i<n)?'‚òÖ':'‚òÜ'; b.classList.toggle('filled', i<n); });
        paint(0);
        btns.forEach(btn=>{
          btn.addEventListener('mouseenter',()=>paint(Number(btn.dataset.v)));
          btn.addEventListener('mouseleave',()=>paint(0));
          btn.addEventListener('click',()=>paint(Number(btn.dataset.v)));
        });
      }

      /* Lecture CSV + calculs */
      function parseCSV(text){
        const rows=[]; let cur=[], val='', inQ=false;
        for(let i=0;i<text.length;i++){
          const c=text[i], n=text[i+1];
          if(inQ){
            if(c=='"' && n=='"'){ val+='"'; i++; }
            else if(c=='"'){ inQ=false; }
            else { val+=c; }
          }else{
            if(c=='"'){ inQ=true; }
            else if(c==','){ cur.push(val); val=''; }
            else if(c=='\n' || c=='\r'){ if(val!==''||cur.length){ cur.push(val); rows.push(cur); cur=[]; val=''; } }
            else { val+=c; }
          }
        }
        if(val!==''||cur.length){ cur.push(val); rows.push(cur); }
        return rows;
      }
      function getCols(header){
        return {
          ts:  header.findIndex(h=>/time|date|horodatage|timestamp/i.test(h))      ?? 0,
          note:header.findIndex(h=>/note|rating|√©chelle|scale/i.test(h))           ?? 1,
          avis:header.findIndex(h=>/avis|comment/i.test(h))                         ?? 2,
          nom: header.findIndex(h=>/nom|name/i.test(h))                             ?? -1
        };
      }
      function computeStats(rows){
        if(rows.length<=1) return {avg:0,totalVotes:0,totalReviews:0,items:[]};
        const header = rows[0], data = rows.slice(1).filter(r=>r.some(c=>c!=='')); 
        const cols = getCols(header);

        let totalVotes=0, sum=0, totalReviews=0;
        const items=[];
        for(const r of data){
          const ts   = r[cols.ts]   || '';
          const note = Number((r[cols.note]||'').toString().replace(',','.')) || 0;
          const avis = (cols.avis>=0 ? r[cols.avis] : '') || '';
          const nom  = (cols.nom>=0  ? r[cols.nom]  : '') || '';
          if(note>0){ totalVotes++; sum += note; }
          if(avis.trim()) totalReviews++;
          if(avis.trim()){
            items.push({timestamp: ts, rating: Math.max(0,Math.min(5,Math.round(note))), text: avis, name: nom});
          }
        }
        items.sort((a,b)=> new Date(b.timestamp) - new Date(a.timestamp));
        const avg = totalVotes ? sum/totalVotes : 0;
        return {avg,totalVotes,totalReviews,items};
      }

      function paintAvg(avg,totalVotes,totalReviews){
        const avgStars=$('avgStars'), avgValue=$('avgValue'), totalVotesEl=$('totalVotes'), totalReviewsEl=$('totalReviews');
        const n = Math.round(avg||0);
        const stars = ['‚òÜ','‚òÜ','‚òÜ','‚òÜ','‚òÜ']; for(let i=0;i<n;i++) stars[i]='‚òÖ';
        avgStars.textContent = stars.join('');
        avgValue.textContent = totalVotes ? avg.toFixed(1) : '‚Äî';
        totalVotesEl.textContent = totalVotes.toLocaleString('fr-FR');
        totalReviewsEl.textContent = totalReviews.toLocaleString('fr-FR');
      }
      function card(r){
        const date = new Date(r.timestamp).toLocaleDateString('fr-FR');
        const stars = '‚òÖ'.repeat(r.rating)+'‚òÜ'.repeat(5-r.rating);
        const name = r.name ? '@'+escapeHTML(r.name) : '@Visiteur';
        return `<div class="review">
          <div class="review-header">
            <span class="review-author">${name}</span>
            <span class="review-date">¬∑ ${escapeHTML(date)}</span>
            <span class="review-stars">‚Äî ${stars}</span>
          </div>
          <div class="review-body">${escapeHTML(r.text)}</div>
        </div>`;
      }

      async function loadLatest(){
        const box = $('latestReviews');
        box.innerHTML = `<div class="review-empty">Chargement‚Ä¶</div>`;
        try{
          const r = await fetch(CSV_URL, {cache:'no-store'});
          const t = await r.text();
          const rows = parseCSV(t);
          const {avg,totalVotes,totalReviews,items} = computeStats(rows);
          paintAvg(avg,totalVotes,totalReviews);
          const latest = items.slice(0,3);
          box.innerHTML = latest.length ? latest.map(card).join('') : `<div class="review-empty">Pas encore d'avis.</div>`;
          window.__allReviews = items;
        }catch{
          box.innerHTML = `<div class="review-empty">Impossible de charger les avis.</div>`;
        }
      }

      /* Tous les avis */
      const showAllBtn = $('showAllReviewsBtn');
      const panel = $('allReviewsPanel');
      const statusEl = $('allReviewsStatus');
      const listAllEl = $('allReviewsList');
      const loadMoreBtn = $('loadMoreBtn');
      const PER_PAGE = 20;
      let page = 0;

      function showPage(){
        const items = window.__allReviews || [];
        const start = page*PER_PAGE;
        const slice = items.slice(start, start+PER_PAGE);
        if(page===0) listAllEl.innerHTML='';
        if(slice.length===0){
          statusEl.textContent = page===0 ? 'Aucun avis.' : 'Tous les avis sont affich√©s.';
          loadMoreBtn.style.display='none';
          return;
        }
        const wrap = document.createElement('div');
        wrap.className='reviews-list';
        wrap.innerHTML = slice.map(card).join('');
        listAllEl.appendChild(wrap);
        page++;
        statusEl.textContent = '';
        loadMoreBtn.style.display = (items.length > page*PER_PAGE) ? 'inline-block' : 'none';
      }

      showAllBtn.addEventListener('click', async ()=>{
        panel.hidden=false; statusEl.textContent='Chargement‚Ä¶';
        if(!window.__allReviews){ await loadLatest(); }
        page=0; showPage();
      });

      loadMoreBtn.addEventListener('click', showPage);
      $('refreshBtn').addEventListener('click', ()=>{ loadLatest(); });

      // init
      loadLatest();
    })();
  </script>
</body>
</html>
