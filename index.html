<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jedi√± Foll ‚Äî Jeu √©ducatif, dr√¥le et strat√©gique</title>
  <link rel="alternate" hreflang="en" href="/jedinfoll/index-en.html">
  <style>
    :root{--mint:#2ec4b6;--bg:#1a1a1a}
    *{box-sizing:border-box}
    body{margin:0;font-family:Arial,sans-serif;background-color:var(--mint);color:#fff}
    header,footer{text-align:center;padding:1rem;background:var(--bg)}
    main{max-width:900px;margin:auto;padding:1rem}
    .topbar{display:flex;justify-content:space-between;align-items:center;max-width:900px;margin:0 auto}
    .lang{font-weight:bold}.lang a{color:#ffcb77;text-decoration:none;margin-left:.5rem}
    .card{background:var(--bg);border-radius:20px;padding:1.5rem;box-shadow:0 4px 12px rgba(0,0,0,.5);margin:1rem auto 2rem}
    h1,h2{color:#fff;margin:0 0 .5rem} h2{color:var(--mint)}
    .price{font-size:1.8rem;font-weight:bold;margin:1rem 0}
    .btn{display:inline-block;padding:.8rem 1.2rem;border-radius:10px;background:linear-gradient(90deg,#00b4d8,#ffcb77);color:#000;font-weight:bold;text-decoration:none}
    .qr{text-align:center;margin-top:1rem}
    .social-links a{color:var(--mint);text-decoration:none;margin:0 10px;font-weight:bold}
    .mentions{font-size:.95rem;color:#ddd;margin-top:1rem;text-align:left;line-height:1.55}
    .flags-inline{display:inline-flex;align-items:center;gap:6px}
    .flag{height:16px;border-radius:2px;border:1px solid #333}
    .small{color:#bbb;font-size:.9rem}
    ul{padding-left:1.2rem}
    .pdf-frame{width:100%;aspect-ratio:1/1.414;max-height:80vh;border:0;background:#fff}
    @media (max-width:600px){.pdf-frame{aspect-ratio:auto;height:70vh}}
    @media print{body{background:#fff;color:#000} header,footer,.card:not(#rules){display:none!important} #rules{box-shadow:none;border:none;background:#fff;color:#000} #rules h2{color:#000}}
    /* √âtoiles + Avis */
    .stars{font-size:1.8rem;user-select:none;display:flex;gap:.1rem}
    .rating-line{display:flex;align-items:center;gap:.5rem;flex-wrap:wrap}
    .rating-summary{font-weight:bold}
    .star-btn{font:inherit;background:transparent;border:none;padding:.1rem .2rem;cursor:pointer;line-height:1;color:#aaa;transition:transform .05s ease}
    .star-btn:focus{outline:2px dotted #ffcb77;outline-offset:2px}
    .star-btn.filled{color:#ffcb77}
    .star-btn:hover{transform:scale(1.05)}
    .reviews-list{display:flex;flex-direction:column;gap:1rem;margin-top:1rem}
    .review{background:#111;border:1px solid #2a2a2a;border-radius:12px;padding:1rem}
    .review-header{display:flex;align-items:center;gap:.6rem;margin-bottom:.4rem;font-size:.95rem;color:#ddd}
    .review-author{font-weight:bold;color:#fff}
    .review-date{color:#bbb;font-size:.9rem}
    .review-stars{color:#ffcb77;letter-spacing:.05em}
    .review-body{white-space:pre-wrap;line-height:1.45}
    .reviews-actions{margin-top:1rem;display:flex;gap:.6rem;flex-wrap:wrap}
    .reviews-actions .btn{background:linear-gradient(90deg,#2ec4b6,#ffcb77)}
    .review-empty{color:#bbb;font-style:italic}
    textarea#reviewText{width:100%;min-height:110px;border-radius:12px;border:1px solid #2a2a2a;padding:.8rem;background:#0f0f0f;color:#fff;resize:vertical}
    .review-send{margin-top:.6rem}
    /* Compteur */
    .counter-wrap{display:flex;justify-content:center;gap:.5rem;align-items:center;flex-wrap:wrap}
    .counter-hide{display:none}
    /* Bandeau moyenne visible */
    .avg-banner{display:flex;gap:.5rem;align-items:center;margin:.25rem 0 .75rem;flex-wrap:wrap}
    .avg-stars{font-size:1.6rem}
    .avg-badges{display:flex;gap:.5rem;align-items:center;flex-wrap:wrap}
    .badge{background:#0f0f0f;border:1px solid #2a2a2a;color:#fff;border-radius:999px;padding:.2rem .6rem;font-size:.85rem}
    /* Panneau "tous les avis" */
    #allReviewsPanel{margin-top:1rem;border-top:1px dashed #2a2a2a;padding-top:1rem}
    #allReviewsList{display:flex;flex-direction:column;gap:1rem}
    #loadMoreBtn{display:none}
    .hint{font-size:.9rem;color:#bbb;margin-top:.4rem}
    .error{color:#ff9e9e}
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <div></div>
      <div class="lang">FR / <a href="/jedinfoll/index-en.html">EN</a></div>
    </div>
    <h1>Jedi√± Foll</h1>
    <p>Le jeu de cartes √©ducatif, dr√¥le et strat√©gique</p>
  </header>

  <main>
    <div class="card">
      <h2>Jedi√± Foll</h2>
      <ul>
        <li>1 √† 4 joueurs ¬∑ 10 √† 30 minutes</li>
        <li>√Ä partir de 6 ans</li>
        <li>5 modes de jeu ‚Äî atteindre exactement le r√©sultat demand√© selon le mode choisi</li>
        <li>La bo√Æte contient 102 cartes</li>
      </ul>
    </div>

    <div class="card" id="rules">
      <h2>R√®gles du jeu</h2>
      <p class="small">Lecture directe ci-dessous ‚Ä¢ <a class="btn" href="/jedinfoll/regles.pdf" download>T√©l√©charger le PDF</a></p>
      <object data="/jedinfoll/regles.pdf" type="application/pdf" class="pdf-frame">
        <iframe src="/jedinfoll/regles.pdf" class="pdf-frame" title="R√®gles"></iframe>
      </object>
      <p class="small">Si le PDF ne s‚Äôaffiche pas, <a href="/jedinfoll/regles.pdf" download>cliquez ici pour le t√©l√©charger</a>.</p>
      <button class="btn" onclick="window.print()">üìÑ Imprimer la section R√®gles</button>
    </div>

    <div class="card" id="videos">
      <h2>Vid√©os</h2>
      <div style="aspect-ratio:16/9; max-width:100%;">
        <iframe width="100%" height="100%" src="https://www.youtube.com/embed/ID_DE_TA_VIDEO" title="Jedi√± Foll ‚Äî D√©mo" frameborder="0" allowfullscreen></iframe>
      </div>
    </div>

    <div class="card" id="pricing">
      <h2>Pr√©commande</h2>
      <div class="price">14,99 ‚Ç¨</div>
      <a href="https://www.paypal.com/ncp/payment/PAYPAL_FRANCE_LINK" class="btn">üá´üá∑ Pr√©commande France ‚Äî 14,99 ‚Ç¨ + 5 ‚Ç¨ livraison</a>
      <a href="https://www.paypal.com/ncp/payment/PAYPAL_MARTINIQUE_LINK" class="btn" style="margin-left:10px; background:linear-gradient(90deg,#06d6a0,#ffd166);">üá≤üá∂ Pr√©commande Martinique ‚Äî 14,99 ‚Ç¨ (Retrait sur place)</a>
      <p class="small" style="margin-top:.8rem;">
        ‚è≥ Disponible √† partir de <strong>mi-juin 2026</strong> (ou plus t√¥t selon la production).<br>
        üì¶ France : ajouter 5 ‚Ç¨ pour la livraison.<br>
        üìç Martinique : retrait sur place uniquement (pas d‚Äôexp√©dition).
      </p>
    </div>

    <div class="card">
      <h2>QR Code</h2>
      <div class="qr">
        <a href="https://api.qrserver.com/v1/create-qr-code/?size=2000x2000&data=https://jedinfoll.github.io/jedinfoll/" download>
          <img src="https://api.qrserver.com/v1/create-qr-code/?size=500x500&data=https://jedinfoll.github.io/jedinfoll/" alt="QR Code vers Jedi√± Foll" style="max-width:300px;">
        </a>
      </div>
      <p class="small">Cliquez sur le QR pour t√©l√©charger en HD.</p>
    </div>

    <div class="card" id="reviews">
      <h2>Avis & Note</h2>

      <div class="avg-banner" aria-live="polite">
        <div id="avgStars" class="stars avg-stars" aria-label="Note moyenne">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</div>
        <div class="avg-badges">
          <span class="badge">Moyenne : <strong><span id="avgValue">‚Äî</span>/5</strong></span>
          <span class="badge">Votes : <strong><span id="totalVotes">0</span></strong></span>
          <span class="badge">Avis : <strong><span id="totalReviews">0</span></strong></span>
        </div>
      </div>

      <div class="small">Votre note :</div>
      <div class="stars" id="rateStars" aria-label="Noter">
        <button type="button" class="star-btn" data-v="1" aria-label="1 √©toile">‚òÜ</button>
        <button type="button" class="star-btn" data-v="2" aria-label="2 √©toiles">‚òÜ</button>
        <button type="button" class="star-btn" data-v="3" aria-label="3 √©toiles">‚òÜ</button>
        <button type="button" class="star-btn" data-v="4" aria-label="4 √©toiles">‚òÜ</button>
        <button type="button" class="star-btn" data-v="5" aria-label="5 √©toiles">‚òÜ</button>
      </div>
      <div id="voteHint" class="hint"></div>

      <div class="review-form" style="margin-top:1rem;">
        <label for="reviewText" class="small">Votre avis (quelques lignes) :</label>
        <textarea id="reviewText" placeholder="Dites-nous ce que vous avez pens√© du jeu‚Ä¶"></textarea>
        <div class="review-send">
          <button class="btn" id="sendReviewBtn">‚úçÔ∏è Laisser un avis</button>
        </div>
        <div id="reviewAlt" class="hint"></div>
      </div>

      <div class="reviews-list" id="latestReviews">
        <div class="review-empty">Chargement des derniers avis‚Ä¶</div>
      </div>

      <div class="reviews-actions">
        <button id="showAllReviewsBtn" class="btn" type="button">üìñ Lire tous les avis</button>
      </div>

      <div id="allReviewsPanel" hidden>
        <div id="allReviewsStatus" class="small">Chargement‚Ä¶</div>
        <div id="allReviewsList"></div>
        <button id="loadMoreBtn" class="btn" type="button">Charger plus</button>
      </div>
    </div>

    <div class="card mentions">
      <h2>Mentions l√©gales</h2>
      <p><strong>√âditeur :</strong> Jedi√± Foll ‚Äî Email : <a href="mailto:jedinfoll@gmail.com">jedinfoll@gmail.com</a></p>
      <p><strong>Responsable de publication :</strong> Jessica Lechertier</p>
      <p><strong>Fabrication :</strong> Cr√©√© en
        <span class="flags-inline">Martinique
          <img src="https://raw.githubusercontent.com/jedinfoll/jedinfoll/main/1000079688.jpg" alt="" class="flag">
        </span>.
      </p>
      <p><strong>H√©bergement :</strong> GitHub Pages ‚Äî GitHub Inc., 88 Colin P Kelly Jr St, San Francisco, CA 94107, USA.</p>
      <p><strong>Propri√©t√© intellectuelle :</strong> Contenus ¬© Jedi√± Foll. Reproduction interdite sans autorisation.</p>
      <p><strong>Donn√©es personnelles :</strong> Les donn√©es collect√©es (commandes, emails) servent uniquement au traitement des achats et ne sont jamais revendues.</p>
    </div>
  </main>

  <footer>
    <div class="social-links">
      <a href="https://www.instagram.com/jedinfoll" target="_blank">Instagram: @jedinfoll</a> |
      <a href="https://www.facebook.com/Jedi%C3%B1%20Foll" target="_blank">Facebook: Jedi√± Foll</a> |
      <a href="mailto:jedinfoll@gmail.com">Email: jedinfoll@gmail.com</a>
    </div>

    <div id="counterRow" class="counter-wrap" aria-live="polite">
      <span>üëÅÔ∏è Visites :</span>
      <img id="hitBadge" alt="Compteur de visites"
        src="https://api.visitorbadge.io/api/visitors?path=jedinfoll%2Fgithub-pages-site&label=Visites&countColor=%232EC4B6&style=flat&labelStyle=upper"
        referrerpolicy="no-referrer"
        style="vertical-align:middle;border-radius:6px;max-height:24px"
      />
      <span id="numericCounter" class="counter-hide">‚Ä¶</span>
    </div>

    <p>¬© 2025 Jedi√± Foll ‚Äî Tous droits r√©serv√©s.</p>
  </footer>

  <script>
    (function(){
      /* ====== CONFIG ====== */
      const API = 'YOUR_WEB_APP_URL'; // <<<<<<<<<<<<<<<<<<<<<<<<<<< remplace par l‚ÄôURL Apps Script publi√©e
      const PER_PAGE = 20;

      const $ = id => document.getElementById(id);
      const escapeHTML = s => s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');

      /* ====== Affichage √©toiles / moyenne ====== */
      const avgStars=$('avgStars'), avgValue=$('avgValue'), totalVotes=$('totalVotes'), totalReviews=$('totalReviews');
      const rateStars=$('rateStars'), starBtns=Array.from(rateStars.querySelectorAll('.star-btn')), voteHint=$('voteHint');
      const reviewText=$('reviewText'), sendBtn=$('sendReviewBtn'), reviewAlt=$('reviewAlt');

      function starsText(n){ const a=['‚òÜ','‚òÜ','‚òÜ','‚òÜ','‚òÜ']; for(let i=0;i<n;i++) a[i]='‚òÖ'; return a.join(''); }
      function paintAvg(n){ avgStars.textContent = starsText(n); }
      function paintStars(n){ starBtns.forEach((b,i)=>{ b.textContent=(i<n)?'‚òÖ':'‚òÜ'; b.classList.toggle('filled', i<n); }); }

      async function fetchStats(){
        const r = await fetch(`${API}?fn=stats`, {cache:'no-store'});
        const d = await r.json();
        avgValue.textContent = d.totalVotes ? d.avg.toFixed(1) : '‚Äî';
        totalVotes.textContent = d.totalVotes.toLocaleString('fr-FR');
        totalReviews.textContent = d.totalReviews.toLocaleString('fr-FR');
        paintAvg(Math.round(d.avg || 0));
      }

      async function postRating(v){
        voteHint.textContent = 'Enregistrement‚Ä¶';
        const r = await fetch(API, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({fn:'rate', rating:v})
        });
        if(!r.ok) throw new Error('rate failed');
        voteHint.textContent = '‚úÖ Merci ! Votre note a √©t√© enregistr√©e.';
      }

      async function postReview(text){
        reviewAlt.textContent = 'Envoi de votre avis‚Ä¶';
        const r = await fetch(API, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({fn:'review', text})
        });
        if(!r.ok) throw new Error('review failed');
        reviewAlt.textContent = '‚úÖ Merci ! Votre avis a √©t√© publi√©.';
        reviewText.value = '';
      }

      // √©toiles : hover + click
      paintAvg(0); paintStars(0);
      starBtns.forEach(btn=>{
        btn.addEventListener('mouseenter',()=>paintStars(Number(btn.dataset.v)));
        btn.addEventListener('mouseleave',()=>paintStars(0));
        btn.addEventListener('click', async ()=>{
          const v = Number(btn.dataset.v);
          try { await postRating(v); await fetchStats(); }
          catch{ voteHint.textContent='‚ö†Ô∏è D√©sol√©, impossible d‚Äôenregistrer pour le moment.'; }
        });
      });

      // Avis : POST direct (pas de popup)
      sendBtn.addEventListener('click', async ()=>{
        const text = (reviewText.value||'').trim();
        if(!text){ reviewAlt.textContent='‚ö†Ô∏è √âcris quelques mots avant d‚Äôenvoyer.'; return; }
        try { await postReview(text); await fetchStats(); loadLatest(); }
        catch { reviewAlt.textContent='‚ö†Ô∏è Impossible d‚Äôenregistrer pour le moment.'; }
      });

      /* ====== Derniers avis (3) ====== */
      const latestReviews=$('latestReviews');
      function renderReview(row){
        const date = new Date(row.timestamp).toLocaleDateString('fr-FR');
        const stars = '‚òÖ'.repeat(row.rating) + '‚òÜ'.repeat(5-row.rating);
        const user = row.name || 'Visiteur';
        const body = row.text ? escapeHTML(row.text) : '<em>(sans texte)</em>';
        return `<div class="review">
          <div class="review-header">
            <span class="review-author">@${escapeHTML(user)}</span>
            <span class="review-date">¬∑ ${escapeHTML(date)}</span>
            <span class="review-stars">‚Äî ${stars}</span>
          </div>
          <div class="review-body">${body}</div>
        </div>`;
      }
      async function loadLatest(){
        latestReviews.innerHTML = `<div class="review-empty">Chargement‚Ä¶</div>`;
        try{
          const r = await fetch(`${API}?fn=list&per=${3}&page=1`, {cache:'no-store'});
          const d = await r.json();
          latestReviews.innerHTML = d.items.length ? d.items.map(renderReview).join('') : `<div class="review-empty">Pas encore d'avis.</div>`;
        }catch{
          latestReviews.innerHTML = `<div class="review-empty">Impossible de charger les avis.</div>`;
        }
      }

      /* ====== Tous les avis pagin√©s ====== */
      const showAllBtn=$('showAllReviewsBtn'), panel=$('allReviewsPanel'), statusEl=$('allReviewsStatus'), listAllEl=$('allReviewsList'), loadMoreBtn=$('loadMoreBtn');
      let curPage = 0, exhausted=false, loading=false;

      function appendList(items){
        const wrap=document.createElement('div'); wrap.className='reviews-list';
        wrap.innerHTML = items.map(renderReview).join('');
        listAllEl.appendChild(wrap);
      }
      async function loadPage(){
        if(loading || exhausted) return;
        loading=true; statusEl.textContent='Chargement‚Ä¶';
        try{
          const next = curPage + 1;
          const r = await fetch(`${API}?fn=list&per=${PER_PAGE}&page=${next}`, {cache:'no-store'});
          const d = await r.json();
          if(next===1) listAllEl.innerHTML='';
          appendList(d.items);
          curPage = next;
          if(d.items.length < PER_PAGE){ exhausted=true; loadMoreBtn.style.display='none'; statusEl.textContent='Tous les avis ont √©t√© charg√©s.'; }
          else{ loadMoreBtn.style.display='inline-block'; statusEl.textContent=''; }
        }catch{
          statusEl.textContent='Erreur de chargement.';
          loadMoreBtn.style.display='inline-block';
        }finally{
          loading=false;
        }
      }
      showAllBtn.addEventListener('click', ()=>{ panel.hidden=false; if(curPage===0) loadPage(); });
      loadMoreBtn.addEventListener('click', loadPage);

      // init
      fetchStats(); loadLatest();

      /* ====== Compteur de visites : badge + fallback ====== */
      const badge = document.getElementById('hitBadge');
      const numeric = document.getElementById('numericCounter');
      badge.addEventListener('error', ()=>{ startNumericCounter(); });
      badge.addEventListener('load',  ()=>{ numeric.classList.add('counter-hide'); });
      function startNumericCounter(){
        badge.classList.add('counter-hide');
        numeric.classList.remove('counter-hide');
        const NS='jedinfoll.github.io', KEY='counter_unique_daily_v2', today='visited_'+new Date().toISOString().slice(0,10);
        const get =()=>fetch(`https://api.countapi.xyz/get/${NS}/${KEY}`,{cache:'no-store'}).then(r=>r.json()).catch(()=>null);
        const create=()=>fetch(`https://api.countapi.xyz/create?namespace=${encodeURIComponent(NS)}&key=${encodeURIComponent(KEY)}&value=0`,{cache:'no-store'}).then(r=>r.json()).catch(()=>null);
        const hit =()=>fetch(`https://api.countapi.xyz/hit/${NS}/${KEY}`,{cache:'no-store'}).then(r=>r.json()).catch(()=>null);
        const set=v=>numeric.textContent=Number(v).toLocaleString('fr-FR');
        (async ()=>{ let d=await get(); if(!d||typeof d.value!=='number'){ await create(); d=await get(); } if(d&&typeof d.value==='number'){ set(d.value); } if(!localStorage.getItem(today)){ const h=await hit(); if(h&&typeof h.value==='number') set(h.value); localStorage.setItem(today,'1'); } })();
      }
    })();
  </script>
</body>
</html>
